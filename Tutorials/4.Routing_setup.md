# **Routing Setup**

```js
app.use("/", loginRouter);
app.use("/users", usersRouter);
app.use("/inbox", inboxRouter);
```
These lines tell Express which router will handle which URL path.

---

# **Create `router` Folder**

Inside the root directory, create:

```
router/
 ├── loginRouter.js
 ├── usersRouter.js
 └── inboxRouter.js
```

### **Why are routers needed?**

* They help keep routes organized.
* They separate route definitions from application logic.
* They make the application modular and scalable.

---

## **Basic Router Template (`loginRouter.js`)**

```js
// external imports
const express = require("express");

// internal imports
const { getLogin } = require("../controller/loginController");

const router = express.Router();

// login page route
router.get("/", getLogin);

module.exports = router;
```

Use the same pattern for `usersRouter.js` and `inboxRouter.js`.

---

# **Create `controller` Folder**

Inside root:

```
controller/
 ├── loginController.js
 ├── usersController.js
 └── inboxController.js
```

### ✅ **Why controllers are needed?**

* They handle business logic.
* They keep routers clean by removing logic from route definitions.
* They follow the MVC pattern (Model–View–Controller).

---

## **Example: `loginController.js`**

```js
function getLogin(req, res, next) {
    res.render("index", {
        title: "Login - Chat Application",
    });
}

module.exports = {
    getLogin,
};
```

---

# **Load Routers in `app.js`**

```js
const loginRouter = require("./router/loginRouter");
const inboxRouter = require("./router/inboxRouter");
const usersRouter = require("./router/usersRouter");
```

Then use them:

```js
app.use("/", loginRouter);
app.use("/users", usersRouter);
app.use("/inbox", inboxRouter);
```

---

# **Execution Flow When Someone Hits “/”**

When a user opens:

```
http://localhost:5000/
```

Express processes the request through the **middleware stack**:

```
Request
 ↓
express.json()
 ↓
express.urlencoded()
 ↓
cookieParser()
 ↓
app.use("/", loginRouter)   ← match found
 ↓
loginRouter.get("/")
 ↓
(decorateHtmlResponse middleware if applied)
 ↓
getLogin() controller
 ↓
res.render("index")
 ↓
Response sent to browser
```
- Your controller renders a page → Express converts EJS to HTML → Express sends the HTML → Browser displays it.
---

# **Problem: Repeating Page Title Every Time**

You currently write:

```js
res.render("index", { title: "Login - Chat Application" });
```

This becomes repetitive and hard to maintain.

---

# **Solution: Add a Middleware to Set Title Automatically**

Attach dynamic title into `res.locals` so EJS can use it without repeating logic.

### **`decorateHtmlResponse.js`**

```js
function decorateHtmlResponse(page_title) {
    return function (req, res, next) {
        res.locals.html = true;
        res.locals.title = `${page_title} - ${process.env.APP_NAME}`;
        next();
    };
}

module.exports = decorateHtmlResponse;
```

---

# **Using the Middleware**

```js
router.get("/", decorateHtmlResponse("Login"), getLogin);
```

Now `getLogin` becomes simple:

```js
function getLogin(req, res) {
    res.render("index");
}
```

EJS automatically receives:

```
<%= title %>
```

From:
`res.locals.title`
